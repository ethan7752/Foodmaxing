<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ethan's Food Ai</title>

<!-- iOS fullscreen meta tags -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Ethan's Food Ai" />
<link rel="apple-touch-icon" href="icon.png" />

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json" />


<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    max-width: 480px;
    margin: 2rem auto;
    padding: 1rem;
  }
  input, button {
    padding: 0.5rem;
    font-size: 1rem;
    margin: 0.5rem 0;
    width: 100%;
    box-sizing: border-box;
    border-radius: 4px;
    border: none;
  }
  input {
    background: #222;
    color: #eee;
  }
  button {
    background: #5e81ac;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #4a699f;
  }
  .result {
    margin-top: 1rem;
    padding: 1rem;
    background: #222;
    border-radius: 6px;
    word-wrap: break-word;
  }
  .result a {
    display: inline-block;
    margin-top: 0.75rem;
    color: #81a1c1;
    text-decoration: none;
  }
  .result a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>

<h1>Ethan's Food Ai</h1>

<form id="foodForm">
  <label for="foodName">Food Name (e.g. banana)</label>
  <input id="foodName" type="text" placeholder="banana" required />

  <label for="foodAmount">Amount (e.g. 1 or 200g)</label>
  <input id="foodAmount" type="text" placeholder="1 or 200g" required />

  <button type="submit">Calculate</button>
</form>

<div class="result" id="result"></div>

<script>
// Expanded food database with many more entries
const foodDB = {
  banana: {
    bloat: 1,
    caloriesPer100g: 89,
    proteinPer100g: 1.1,
    fatPer100g: 0.3,
    carbsPer100g: 23,
    weightPerUnit: 118
  },
  steak: {
    bloat: 7,
    caloriesPer100g: 250,
    proteinPer100g: 26,
    fatPer100g: 20,
    carbsPer100g: 0,
    weightPerUnit: 200
  },
  apple: {
    bloat: 2,
    caloriesPer100g: 52,
    proteinPer100g: 0.3,
    fatPer100g: 0.2,
    carbsPer100g: 14,
    weightPerUnit: 182
  },
  chickenbreast: {
    bloat: 3,
    caloriesPer100g: 165,
    proteinPer100g: 31,
    fatPer100g: 3.6,
    carbsPer100g: 0,
    weightPerUnit: 150
  },
  broccoli: {
    bloat: 5,
    caloriesPer100g: 34,
    proteinPer100g: 2.8,
    fatPer100g: 0.4,
    carbsPer100g: 7,
    weightPerUnit: 91
  },
  egg: {
    bloat: 1,
    caloriesPer100g: 155,
    proteinPer100g: 13,
    fatPer100g: 11,
    carbsPer100g: 1.1,
    weightPerUnit: 50
  },
  rice: {
    bloat: 4,
    caloriesPer100g: 130,
    proteinPer100g: 2.7,
    fatPer100g: 0.3,
    carbsPer100g: 28,
    weightPerUnit: 100
  },
  salmon: {
    bloat: 3,
    caloriesPer100g: 206,
    proteinPer100g: 22,
    fatPer100g: 12,
    carbsPer100g: 0,
    weightPerUnit: 154
  },
  avocado: {
    bloat: 2,
    caloriesPer100g: 160,
    proteinPer100g: 2,
    fatPer100g: 15,
    carbsPer100g: 9,
    weightPerUnit: 150
  },
  almond: {
    bloat: 2,
    caloriesPer100g: 579,
    proteinPer100g: 21,
    fatPer100g: 50,
    carbsPer100g: 22,
    weightPerUnit: 1 // For nuts better to input grams, but 1g unit here
  },
  yogurt: {
    bloat: 4,
    caloriesPer100g: 59,
    proteinPer100g: 10,
    fatPer100g: 0.4,
    carbsPer100g: 3.6,
    weightPerUnit: 100
  },
  potato: {
    bloat: 5,
    caloriesPer100g: 77,
    proteinPer100g: 2,
    fatPer100g: 0.1,
    carbsPer100g: 17,
    weightPerUnit: 150
  },
  carrot: {
    bloat: 1,
    caloriesPer100g: 41,
    proteinPer100g: 0.9,
    fatPer100g: 0.2,
    carbsPer100g: 10,
    weightPerUnit: 61
  },
  oats: {
    bloat: 4,
    caloriesPer100g: 389,
    proteinPer100g: 17,
    fatPer100g: 7,
    carbsPer100g: 66,
    weightPerUnit: 40
  },
  wheyprotein: {
    bloat: 2,
    caloriesPer100g: 400,
    proteinPer100g: 80,
    fatPer100g: 7,
    carbsPer100g: 8,
    weightPerUnit: 30
  },
  bread: {
    bloat: 3,
    caloriesPer100g: 265,
    proteinPer100g: 9,
    fatPer100g: 3.2,
    carbsPer100g: 49,
    weightPerUnit: 30
  },
  cheese: {
    bloat: 3,
    caloriesPer100g: 402,
    proteinPer100g: 25,
    fatPer100g: 33,
    carbsPer100g: 1.3,
    weightPerUnit: 30
  },
  peanutbutter: {
    bloat: 4,
    caloriesPer100g: 588,
    proteinPer100g: 25,
    fatPer100g: 50,
    carbsPer100g: 20,
    weightPerUnit: 32
  }
};

// Helper: parse amount input (e.g. "1", "150g")
function parseAmount(input, food) {
  input = input.trim().toLowerCase();
  if (input.endsWith("g")) {
    const grams = parseFloat(input.replace("g", "").trim());
    if (isNaN(grams) || grams <= 0) return null;
    return grams;
  } else {
    const units = parseFloat(input);
    if (isNaN(units) || units <= 0) return null;
    if (!food.weightPerUnit) return null;
    return units * food.weightPerUnit;
  }
}

function round(num) {
  return Math.round(num * 10) / 10;
}

// Tracker totals object
let dailyTotals = {
  calories: 0,
  protein: 0,
  fat: 0,
  carbs: 0
};

const form = document.getElementById("foodForm");
const resultDiv = document.getElementById("result");
const trackerTotalsDiv = document.getElementById("trackerTotals");
const resetBtn = document.getElementById("resetTracker");

function updateTrackerUI() {
  trackerTotalsDiv.textContent =
    `Calories: ${round(dailyTotals.calories)} kcal | Protein: ${round(dailyTotals.protein)} g | Fat: ${round(dailyTotals.fat)} g | Carbs: ${round(dailyTotals.carbs)} g`;
}

// Load saved totals from localStorage on page load
function loadTracker() {
  const saved = localStorage.getItem("dailyTotals");
  if (saved) {
    dailyTotals = JSON.parse(saved);
    updateTrackerUI();
  }
}

// Save totals to localStorage
function saveTracker() {
  localStorage.setItem("dailyTotals", JSON.stringify(dailyTotals));
}

// Reset tracker button handler
resetBtn.addEventListener("click", () => {
  dailyTotals = { calories: 0, protein: 0, fat: 0, carbs: 0 };
  updateTrackerUI();
  saveTracker();
});

form.addEventListener("submit", e => {
  e.preventDefault();

  const foodNameRaw = document.getElementById("foodName").value.trim().toLowerCase().replace(/\s/g, "");
  const amountRaw = document.getElementById("foodAmount").value.trim();

  const food = foodDB[foodNameRaw];
  if (!food) {
    alert("Food not found in database.");
    return;
  }

  const grams = parseAmount(amountRaw, food);
  if (grams === null) {
    alert("Invalid amount. Use number (for whole items) or grams (e.g. 150g).");
    return;
  }

  const factor = grams / 100;

  const calories = food.caloriesPer100g * factor;
  const protein = food.proteinPer100g * factor;
  const fat = food.fatPer100g * factor;
  const carbs = food.carbsPer100g * factor;
  const bloat = food.bloat;

  const searchUrl = `https://www.woolworths.co.nz/shop/searchproducts?search=${encodeURIComponent(foodNameRaw)}`;

  // Show results with Add to Daily Tracker button
  resultDiv.innerHTML = `
    <strong>${grams}g of ${foodNameRaw}</strong><br/>
    Calories: ${round(calories)} kcal<br/>
    Protein: ${round(protein)} g<br/>
    Fat: ${round(fat)} g<br/>
    Carbs: ${round(carbs)} g<br/>
    Bloat level: ${bloat} / 10<br/>
    <a href="${searchUrl}" target="_blank" rel="noopener noreferrer">Buy ${foodNameRaw} on Woolworths NZ</a><br/>
    <button id="addToTracker" style="margin-top: 10px; padding: 0.5rem 1rem; background:#5e81ac; color:#fff; border:none; border-radius:4px; cursor:pointer;">Add to Daily Tracker</button>
  `;

  document.getElementById("addToTracker").addEventListener("click", () => {
    dailyTotals.calories += calories;
    dailyTotals.protein += protein;
    dailyTotals.fat += fat;
    dailyTotals.carbs += carbs;
    updateTrackerUI();
    saveTracker();
  });
});

// On page load, restore saved tracker values
loadTracker();
</script>
<!-- Daily tracker bar -->
<div id="dailyTracker" style="position: fixed; bottom: 0; left: 0; right: 0; background: #222; color: #eee; padding: 0.75rem 1rem; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; max-width: 480px; margin: 0 auto; box-sizing: border-box;">
  <div id="trackerTotals">
    Calories: 0 kcal | Protein: 0 g | Fat: 0 g | Carbs: 0 g
  </div>
  <button id="resetTracker" style="background:#5e81ac; color:#fff; border:none; padding:0.3rem 0.6rem; border-radius:4px; cursor:pointer;">Reset</button>
</div>

</body>
</html>
