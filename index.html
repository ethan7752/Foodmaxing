<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Food & Water Logger with Photos</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  input, select, button { font-size: 1rem; margin: 6px 0; padding: 6px; }
  button { cursor: pointer; }
  .list-item { border-bottom: 1px solid #ccc; padding: 8px 0; }
  img { max-width: 200px; margin-top: 6px; border: 1px solid #ccc; border-radius: 4px; }
  .flex-row { display: flex; align-items: center; justify-content: space-between; }
</style>
</head>
<body>

<h2>Food & Water Logger</h2>

<!-- Food entry form -->
<form id="foodForm">
  <input type="text" id="foodName" placeholder="Food Name" list="foodNames" autocomplete="off" required />
  <input type="number" id="foodAmount" placeholder="Amount" min="0.01" step="0.01" required />
  <select id="portionSelect">
    <option value="g">grams</option>
    <option value="ml">ml</option>
    <option value="piece">pieces</option>
  </select>
  <input type="file" id="mealPhotoInput" accept="image/*" capture="environment" />
  <button type="submit">Add Meal</button>
</form>

<datalist id="foodNames">
  <!-- example food names -->
  <option value="Steak"></option>
  <option value="Chicken"></option>
  <option value="Rice"></option>
  <option value="Watermelon"></option>
</datalist>

<!-- Water logging -->
<div>
  <input type="number" id="waterAmountInput" placeholder="ml water" min="1" />
  <button id="addWaterBtn">Add Water to Log</button>
</div>

<h3>Daily Log</h3>
<div id="mealHistory">No meals logged yet.</div>

<script>
// Example food data
const foods = {
  steak: { calories: 250, protein: 26, fat: 15, carbs: 0 },
  chicken: { calories: 165, protein: 31, fat: 3.6, carbs: 0 },
  rice: { calories: 130, protein: 2.7, fat: 0.3, carbs: 28 },
  watermelon: { calories: 30, protein: 0.6, fat: 0.2, carbs: 8 }
};

let dailyLog = JSON.parse(localStorage.getItem("dailyLog") || "[]");

// Utils
function normalizeName(name) {
  return name.trim().toLowerCase();
}

function fmt(n) {
  return Number(n).toFixed(1);
}

function saveLog(log) {
  localStorage.setItem("dailyLog", JSON.stringify(log));
}

function calculateMacros(food, amount, portionType) {
  // amount assumed in grams/ml for simplicity, pieces ignored here
  if (amount <= 0) return null;
  // For this demo, assume amount always in grams/ml. Piece handling could be added.
  const factor = amount / 100; // macros per 100g/ml
  return {
    calories: food.calories * factor,
    protein: food.protein * factor,
    fat: food.fat * factor,
    carbs: food.carbs * factor,
    weight: amount
  };
}

function updateProgress() {
  // Stub: You can add totals update or progress bars here if you want
}

// Add Food to Log
function addFoodToLog(foodName, amountInput, portionType, photoDataUrl = null) {
  const normName = normalizeName(foodName);
  if (!(normName in foods)) {
    alert("Food not found. Try adding a custom food first.");
    return false;
  }
  const amount = parseFloat(amountInput);
  if (isNaN(amount) || amount <= 0) {
    alert("Invalid amount input.");
    return false;
  }
  const macros = calculateMacros(foods[normName], amount, portionType);
  if (!macros) return false;
  dailyLog.push({
    name: foodName,
    ...macros,
    timestamp: Date.now(),
    photo: photoDataUrl,
    type: "meal"
  });
  saveLog(dailyLog);
  renderMealHistory();
  updateProgress();
  return true;
}

// Add Water to Log
function addWaterToLog(amount) {
  if (amount <= 0) {
    alert("Enter a positive amount of water.");
    return;
  }
  dailyLog.push({
    name: "Water",
    calories: 0,
    protein: 0,
    fat: 0,
    carbs: 0,
    weight: amount,
    timestamp: Date.now(),
    type: "water"
  });
  saveLog(dailyLog);
  renderMealHistory();
  updateProgress();
}

// Render meal history with photo toggles
function renderMealHistory() {
  const mealHistoryDiv = document.getElementById("mealHistory");
  mealHistoryDiv.innerHTML = "";
  if (dailyLog.length === 0) {
    mealHistoryDiv.textContent = "No meals logged yet.";
    return;
  }
  dailyLog.forEach((meal, i) => {
    const div = document.createElement("div");
    div.classList.add("list-item");

    const flexDiv = document.createElement("div");
    flexDiv.classList.add("flex-row");

    const textDiv = document.createElement("div");
    let nameText = meal.name;
    if (meal.type === "water") {
      nameText += ` — ${meal.weight} ml`;
    } else {
      nameText += ` — ${fmt(meal.calories)} kcal, ${fmt(meal.protein)}g P, ${fmt(meal.fat)}g F, ${fmt(meal.carbs)}g C, ${fmt(meal.weight)}g`;
    }
    textDiv.textContent = nameText;

    const delBtn = document.createElement("button");
    delBtn.textContent = "❌";
    delBtn.title = "Remove this entry";
    delBtn.style.background = "#a94442";
    delBtn.style.width = "36px";
    delBtn.style.flexShrink = 0;
    delBtn.addEventListener("click", () => {
      dailyLog.splice(i, 1);
      saveLog(dailyLog);
      renderMealHistory();
      updateProgress();
    });

    flexDiv.appendChild(textDiv);
    flexDiv.appendChild(delBtn);

    div.appendChild(flexDiv);

    // Show Image button if photo exists
    if (meal.photo) {
      const showImgBtn = document.createElement("button");
      showImgBtn.textContent = "Show Image";
      showImgBtn.style.marginTop = "6px";
      let imgVisible = false;
      const img = document.createElement("img");
      img.src = meal.photo;
      img.style.display = "none";

      showImgBtn.addEventListener("click", () => {
        imgVisible = !imgVisible;
        img.style.display = imgVisible ? "block" : "none";
        showImgBtn.textContent = imgVisible ? "Hide Image" : "Show Image";
      });

      div.appendChild(showImgBtn);
      div.appendChild(img);
    }

    mealHistoryDiv.appendChild(div);
  });
}

// Elements
const foodForm = document.getElementById("foodForm");
const foodNameInput = document.getElementById("foodName");
const portionSelect = document.getElementById("portionSelect");
const mealPhotoInput = document.getElementById("mealPhotoInput");
const waterAmountInput = document.getElementById("waterAmountInput");
const addWaterBtn = document.getElementById("addWaterBtn");

// Food form submit handler with photo upload
foodForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const foodName = foodNameInput.value.trim();
  const amount = document.getElementById("foodAmount").value.trim();
  const portionType = portionSelect.value;

  const file = mealPhotoInput.files[0];
  if (!foodName || !amount) {
    alert("Please fill in food name and amount.");
    return;
  }

  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      const photoDataUrl = event.target.result;
      if (addFoodToLog(foodName, amount, portionType, photoDataUrl)) {
        foodNameInput.value = "";
        document.getElementById("foodAmount").value = "";
        mealPhotoInput.value = "";
      }
    };
    reader.readAsDataURL(file);
  } else {
    if (addFoodToLog(foodName, amount, portionType, null)) {
      foodNameInput.value = "";
      document.getElementById("foodAmount").value = "";
      mealPhotoInput.value = "";
    }
  }
});

// Water add button handler
addWaterBtn.addEventListener("click", () => {
  const val = parseInt(waterAmountInput.value, 10);
  if (isNaN(val) || val <= 0) {
    alert("Please enter a valid positive water amount in ml.");
    return;
  }
  addWaterToLog(val);
  waterAmountInput.value = "";
});

// Initial render
renderMealHistory();
updateProgress();
</script>

</body>
</html>
